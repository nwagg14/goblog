<!doctype html>
<html ng-app="post" ng-controller="PostCtrl">
<head>
<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>
<script src="/files/js/lib/markdown.js"></script>
<link rel="stylesheet" type="text/css" href="/files/css/main.css" media="screen" />
</head>
<body>
<article>
<h1>{{post.title}}</h1>
<h3>{{post.author}} {{post.date | date : 'mediumDate'}}</h3>
<p ng-bind-html="post.content | markdown">
</p>
</article>
<navbar>
<ul>
<li ng-repeat="p in recentPosts">
	<a href="/post/{{p.id}}">{{p.title}}</a>
</li>
</ul>
</navbar>
</body>
<script>
  angular.module('post', [])
    .controller('PostCtrl', ['$scope', '$location', '$http', function($scope, $routeParams, $http) {
        var path = $routeParams.absUrl()
        var splitPath = path.split('/')
        $http.get("/data/post/" + splitPath[splitPath.length - 1])
          .then(function(response) {
            $scope.post = response.data
          })
        $http.get("/data/top")
          .then(function(response) {
            $scope.recentPosts = response.data
          })
    }])
    .filter('markdown', ['$sce', function($sce) {
      return function(input) {
        if(input != undefined) {
        	var output = $sce.trustAsHtml(markdown.toHTML(input));
        	return output;
	}
	return "";
      }
    }]);
</script>
</html>
