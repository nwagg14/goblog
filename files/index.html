<!doctype html>
<html ng-app="index" ng-controller="IndexCtrl">
<head>
<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>
<script src="/files/js/lib/markdown.js"></script>
<link rel="stylesheet" type="text/css" href="/files/css/main.css" media="screen" />
</head>
<body>
<article ng-repeat="post in posts">
<h1><a href="/post/{{post.id}}">{{post.title}}</a></h1>
<h3>{{post.author}} {{post.date | date : 'mediumDate'}}</h3>
<p ng-bind-html="post.content | markdown">
</p>
</article>
</body>
<script>
  angular.module('index', [])
    .controller('IndexCtrl', ['$scope', '$http', function($scope, $http) {
        $http.get("/data/top")
          .then(function(response) {
            $scope.posts = response.data
          })
    }])
    .filter('markdown', ['$sce', function($sce) {
      return function(input) {
        if(input != undefined) {
        	var output = $sce.trustAsHtml(markdown.toHTML(input));
        	return output;
	}
	return "";
      }
    }]);
</script>
</html>
